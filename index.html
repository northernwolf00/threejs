<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>3D Model Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
        }
        
        body {
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            color: white;
        }
        
        .header {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 10;
            backdrop-filter: blur(10px);
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(45deg, #3498db, #9b59b6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .controls {
            display: flex;
            gap: 12px;
        }
        
        button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-size: 14px;
        }
        
        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        #renderer-container {
            flex: 1;
            position: relative;
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid #3498db;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            padding: 0 20px;
            z-index: 5;
        }
        
        .model-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            font-size: 14px;
            z-index: 5;
            backdrop-filter: blur(10px);
        }
        
        .model-info h3 {
            margin-bottom: 10px;
            color: #3498db;
        }
        
        .model-info p {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .error {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            color: #e74c3c;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 20px;
            text-align: center;
            z-index: 200;
        }
        
        .error h2 {
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .error p {
            margin-bottom: 15px;
            font-size: 16px;
            max-width: 600px;
            line-height: 1.6;
        }
        
        .error button {
            background: #e74c3c;
            padding: 10px 25px;
            font-size: 16px;
        }
        
        .github-banner {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 30px;
            z-index: 5;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
        }
        
        .github-banner a {
            color: #3498db;
            text-decoration: none;
        }
        
        .github-banner a:hover {
            text-decoration: underline;
        }
        
        .model-selector {
            position: absolute;
            bottom: 60px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 10px;
            z-index: 5;
        }
        
        .model-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
        }
        
        @media (max-width: 768px) {
            .model-info {
                max-width: 250px;
                font-size: 12px;
                padding: 10px;
            }
            
            .controls {
                gap: 8px;
            }
            
            button {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .logo {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">3D Model Viewer</div>
        <div class="controls">
            <button id="reset-view">Reset View</button>
            <button id="toggle-lights">Dim Lights</button>
            <button id="toggle-rotation">Auto Rotate</button>
        </div>
    </div>
    
    <div class="github-banner">
        <svg height="20" viewBox="0 0 16 16" width="20">
            <path fill="#3498db" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
        <span>Model: <a href="https://github.com/northernwolf00/threejs/blob/main/models/desk/mesa_pc.obj" target="_blank">mesa_pc.obj</a></span>
    </div>
    
    <div id="renderer-container">
        <canvas id="canvas"></canvas>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div id="loading-text">Loading 3D Model...</div>
        </div>
        
        <div class="instructions">
            Swipe to rotate • Pinch to zoom • Two-finger drag to pan
        </div>
        
        <div class="model-info">
            <h3>Model Information</h3>
            <p><strong>Name:</strong> Computer Desk</p>
            <p><strong>Format:</strong> OBJ with MTL materials</p>
            <p><strong>Source:</strong> GitHub Repository</p>
            <p id="model-url-info">Loading model details...</p>
        </div>
        
        <div class="model-selector">
            <button class="model-btn" data-obj="https://northernwolf00.github.io/threejs/models/desk/mesa_pc.obj" data-mtl="https://northernwolf00.github.io/threejs/models/desk/mesa_pc.mtl">Desk</button>
            <button class="model-btn" data-obj="https://northernwolf00.github.io/threejs/models/chair/silla.obj" data-mtl="https://northernwolf00.github.io/threejs/models/chair/silla.mtl">Chair</button>
            <button class="model-btn" data-obj="https://northernwolf00.github.io/threejs/models/couch/sofa.obj" data-mtl="https://northernwolf00.github.io/threejs/models/couch/sofa.mtl">Sofa</button>
        </div>
    </div>

    <script>
        // Main application
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize the 3D viewer
            try {
                const viewer = new ModelViewer();
                viewer.init();
            } catch (error) {
                showError(`Failed to initialize 3D viewer: ${error.message}`);
            }
        });
        
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.innerHTML = `
                <h2>Error Loading 3D Viewer</h2>
                <p>${message}</p>
                <p>Please check the URL parameters and try again.</p>
                <button onclick="window.location.reload()">Reload Viewer</button>
            `;
            document.getElementById('renderer-container').appendChild(errorDiv);
            document.getElementById('loading').style.display = 'none';
        }
        
        class ModelViewer {
            constructor() {
                // DOM elements
                this.canvas = document.getElementById('canvas');
                this.loadingDiv = document.getElementById('loading');
                this.loadingText = document.getElementById('loading-text');
                this.modelUrlInfo = document.getElementById('model-url-info');
                
                // Three.js components
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.controls = null;
                this.model = null;
                
                // Lighting
                this.ambientLight = null;
                this.directionalLight = null;
                this.hemisphereLight = null;
                this.lightsEnabled = true;
                this.autoRotate = true;
                
                // Model parameters from URL
                this.objUrl = "https://northernwolf00.github.io/threejs/models/desk/mesa_pc.obj";
                this.mtlUrl = "https://northernwolf00.github.io/threejs/models/desk/mesa_pc.mtl";
                
                // Animation
                this.animateId = null;
                
                // Bind event handlers
                this.onWindowResize = this.onWindowResize.bind(this);
                this.animate = this.animate.bind(this);
                this.resetView = this.resetView.bind(this);
                this.toggleLights = this.toggleLights.bind(this);
                this.toggleRotation = this.toggleRotation.bind(this);
                this.loadModelFromButton = this.loadModelFromButton.bind(this);
            }
            
            init() {
                // Update model info
                this.modelUrlInfo.innerHTML = `<strong>URL:</strong> ${this.objUrl.split('/').pop()}`;
                this.loadingText.textContent = `Loading ${this.objUrl.split('/').pop()}...`;
                
                // Initialize Three.js
                this.setupScene();
                this.setupCamera();
                this.setupRenderer();
                this.setupLights();
                this.setupControls();
                
                // Load the model
                this.loadModel();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Start animation loop
                this.animate();
            }
            
            setupScene() {
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x1a1a2e);
                this.scene.fog = new THREE.Fog(0x1a1a2e, 20, 100);
            }
            
            setupCamera() {
                // Create camera
                const aspect = window.innerWidth / window.innerHeight;
                this.camera = new THREE.PerspectiveCamera(45, aspect, 0.1, 1000);
                this.camera.position.set(0, 0, 15);
            }
            
            setupRenderer() {
                // Create renderer
                this.renderer = new THREE.WebGLRenderer({
                    canvas: this.canvas,
                    antialias: true,
                    alpha: false
                });
                this.renderer.setPixelRatio(window.devicePixelRatio);
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                
                // Add resize handler
                window.addEventListener('resize', this.onWindowResize, false);
            }
            
            setupLights() {
                // Ambient light
                this.ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
                this.scene.add(this.ambientLight);
                
                // Directional light
                this.directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                this.directionalLight.position.set(5, 10, 7);
                this.directionalLight.castShadow = true;
                this.scene.add(this.directionalLight);
                
                // Hemisphere light for more natural outdoor lighting
                this.hemisphereLight = new THREE.HemisphereLight(0xffffbb, 0x080820, 0.3);
                this.scene.add(this.hemisphereLight);
                
                // Point lights for additional highlights
                const pointLight1 = new THREE.PointLight(0x4a6bff, 0.5, 50);
                pointLight1.position.set(10, 10, 10);
                this.scene.add(pointLight1);
                
                const pointLight2 = new THREE.PointLight(0xff6b6b, 0.5, 50);
                pointLight2.position.set(-10, -10, -10);
                this.scene.add(pointLight2);
            }
            
            setupControls() {
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.screenSpacePanning = false;
                this.controls.minDistance = 5;
                this.controls.maxDistance = 50;
                this.controls.maxPolarAngle = Math.PI / 2;
                this.controls.autoRotate = this.autoRotate;
                this.controls.autoRotateSpeed = 1.0;
            }
            
            loadModel() {
                if (!this.objUrl) return;
                
                // Show loading indicator
                this.loadingDiv.style.display = 'flex';
                
                // Remove existing model if any
                if (this.model) {
                    this.scene.remove(this.model);
                    this.model = null;
                }
                
                // Load MTL materials if provided
                const loadObj = (materials) => {
                    const loader = new THREE.OBJLoader();
                    if (materials) loader.setMaterials(materials);
                    
                    loader.load(
                        this.objUrl,
                        (object) => {
                            this.model = object;
                            
                            // Center and scale model
                            const box = new THREE.Box3().setFromObject(object);
                            const center = box.getCenter(new THREE.Vector3());
                            const size = box.getSize(new THREE.Vector3());
                            
                            object.position.sub(center);
                            const maxDim = Math.max(size.x, size.y, size.z);
                            const scale = 10 / maxDim;
                            object.scale.set(scale, scale, scale);
                            
                            this.scene.add(object);
                            this.loadingDiv.style.display = 'none';
                            
                            // Update model info
                            this.modelUrlInfo.innerHTML = `
                                <strong>Name:</strong> ${this.objUrl.split('/').pop().replace('.obj', '')}
                                <br><strong>Format:</strong> OBJ with MTL materials
                                <br><strong>URL:</strong> ${this.objUrl.split('/').pop()}
                            `;
                        },
                        (xhr) => {
                            const percent = (xhr.loaded / xhr.total * 100).toFixed(0);
                            this.loadingText.textContent = `Loading model... ${percent}%`;
                        },
                        (error) => {
                            this.loadingDiv.style.display = 'none';
                            showError(`Failed to load OBJ file: ${error.message}`);
                        }
                    );
                };
                
                if (this.mtlUrl) {
                    const mtlLoader = new THREE.MTLLoader();
                    mtlLoader.load(
                        this.mtlUrl,
                        (materials) => {
                            materials.preload();
                            loadObj(materials);
                        },
                        undefined,
                        (error) => {
                            console.warn('Failed to load MTL file, loading OBJ without materials', error);
                            loadObj(null);
                        }
                    );
                } else {
                    loadObj(null);
                }
            }
            
            setupEventListeners() {
                // Reset view button
                document.getElementById('reset-view').addEventListener('click', this.resetView);
                
                // Toggle lights button
                document.getElementById('toggle-lights').addEventListener('click', this.toggleLights);
                
                // Toggle rotation button
                document.getElementById('toggle-rotation').addEventListener('click', this.toggleRotation);
                
                // Model selector buttons
                document.querySelectorAll('.model-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        this.objUrl = button.dataset.obj;
                        this.mtlUrl = button.dataset.mtl;
                        this.loadModel();
                    });
                });
            }
            
            onWindowResize() {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth, window.innerHeight);
            }
            
            resetView() {
                if (this.model) {
                    this.camera.position.set(0, 0, 15);
                    this.camera.lookAt(0, 0, 0);
                    this.controls.reset();
                }
            }
            
            toggleLights() {
                this.lightsEnabled = !this.lightsEnabled;
                
                const intensity = this.lightsEnabled ? 1 : 0.1;
                this.ambientLight.intensity = intensity * 0.5;
                this.directionalLight.intensity = intensity * 0.8;
                this.hemisphereLight.intensity = intensity * 0.3;
                
                // Update button text
                const button = document.getElementById('toggle-lights');
                button.textContent = this.lightsEnabled ? 'Dim Lights' : 'Bright Lights';
            }
            
            toggleRotation() {
                this.autoRotate = !this.autoRotate;
                this.controls.autoRotate = this.autoRotate;
                
                // Update button text
                const button = document.getElementById('toggle-rotation');
                button.textContent = this.autoRotate ? 'Stop Rotation' : 'Auto Rotate';
            }
            
            animate() {
                this.animateId = requestAnimationFrame(this.animate);
                
                if (this.controls) {
                    this.controls.update();
                }
                
                if (this.renderer && this.scene && this.camera) {
                    this.renderer.render(this.scene, this.camera);
                }
            }
        }
    </script>
</body>
</html>
